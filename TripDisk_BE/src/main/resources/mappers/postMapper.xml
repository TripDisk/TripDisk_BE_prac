<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.tripdisk.mvc.model.dao.PostDao">

	<!-- 1. 게시글 전체 조회 + 검색 -->
	<select id="selectAll" resultType="Post">
		SELECT * FROM post;
	</select>

	<!-- 2. 게시글 상세 조회 -->
	<select id="selectOne" resultType="Post" parameterType="int">
		SELECT *
		FROM post WHERE post_id = #{postId};
	</select>

	<!-- 3. 게시글 등록 -->
	<insert id="insertPost" parameterType="Post"
		keyProperty="postId" useGeneratedKeys="true">
		INSERT INTO post (schedule_id,
		place, date, title, content, is_shared)
		VALUES (#{scheduleId},
		#{place}, #{date}, #{title}, #{content}, #{isShared});
	</insert>
	<!-- 4. 게시글 수정 -->
	<update id="updatePost" parameterType="Post">
		UPDATE post
		SET schedule_id
		= #{scheduleId}, place = #{place}, date = #{date}, title = #{title},
		content = #{content}, is_shared = #{isShared}
		WHERE post_id =
		#{postId};
	</update>
	<!-- 5. 게시글 삭제 -->
	<delete id="deletePost" parameterType="int">
		DELETE FROM post
		WHERE
		post_id = #{postId};
	</delete>

	<!-- 6. 다중 이미지파일 업로드 -->
	
	<!-- files 테이블 전체 컬럼 -->
	<sql id="fileColumns">
		file_id
		, post_id
		, file_name
	</sql>

	<insert id="insertImageFile" parameterType="ImageFile">
		INSERT INTO imagefiles (
		<include refid="fileColumns" />
		) 
		VALUES
		<foreach item="file" collection="imageFiles" separator=","> 
			(
			#{file.fileId}
			, #{file.postId}
			, #{file.fileName}
			)
		</foreach>
	</insert>
	<!-- 
	sql 태그는 재사용하기 위한 사용하는 태그
	sql태그의 id와 inclue태그의 refid를 연결해서 재사용 가능
	foreach를 통해 리스트로 전달된 데이터(collection="list")를 순회하고 항목들은 ","로 구분
	collection="imageFiles"로 써도됨.
	-->
	
	
	<!-- 7. postId로 이미지 리스트 가져오기 -->
	<select id="selectImageFileByPostId" resultType="ImageFile" parameterType="int">
		SELECT *
		FROM imagefiles WHERE post_id = #{postId};
	</select>
	
	<!-- 스케줄id로 게시글 조회 -->
</mapper>


